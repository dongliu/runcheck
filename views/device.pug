extends layout-history.pug

block head
  link(rel='stylesheet', href='/stylesheets/typeaheadjs.css')
  title RunCheck device
    = ' '
    = device.serialNo

block content
  br
  //- div#device(style='display: none') #{JSON.stringify(device)}
  div(id = 'message')
  .well(id = 'device-details')
    include ./client-side/device-details.pug
  .btn-toolbar
    button.btn.btn-space.btn-primary(id = 'reject-install') Reject
    button.btn.btn-space.btn-primary(id = 'approve-install') Approve
    button.btn.btn-space.btn-primary(id = 'install') Install
    button.btn.btn-space.btn-danger(id = 'set-spare') Set spare
  br
  - var spare = _.get(device, 'installToDevice.id') === null && _.get(device, 'installToSlot.id') === null;
  .panel.panel-default(id = 'prepare-panel' class=spare? '' : 'hidden')
    .panel-heading
      .btn-group
        button.btn.btn-space.btn-primary.dropdown-toggle(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')#preInstall
          | Prepare install
          = ' '
          span.caret
        ul.dropdown-menu
          li
            a.prepare-install device
          li
            a.prepare-install slot
      Strong(id = 'prepare-title')
    .panel-body
      form.form-inline.slot.hidden
        .form-group
          label Slot:
          = ' '
          .input-group
            input.form-control(type='text')
        = ' '
        button.btn.btn-space.btn-primary(type='submit', value='slot') Confirm
        button.btn.btn-space(type='reset') Cancel
      form.form-inline.device.hidden
        .form-group
          label Device:
          = ' '
          .input-group
            input.form-control(type='text')
        = ' '
        button.btn.btn-space.btn-primary(type='submit', value='device') Confirm
        button.btn.btn-space(type='reset') Cancel
  .well
    if !device.checklist || !device.checklist.required
      form(method='POST')
        input(type='hidden' name='action', value="require-checklist")
        button(type='submit') Request Checklist
    else
      //- update checklist
      form#updateChecklist(method="POST")
        input(type="hidden" name="action" value="update-checklist")
        table.table
          thead
            tr
              for subject in checklistSubjects
                th.text-center #{subject} OK
          tbody
            tr
              for subject in checklistSubjects
                - var item = device.checklist[subject];
                td.text-center
                  if item.required !== false
                    select(name="#{subject}" value="#{item.value}")
                      for checklistValue in checklistValues
                        if item.value === checklistValue
                          option(selected="selected")= checklistValue
                        else
                          option= checklistValue
                  else
                    span N/A
        .row
          .col-xs-6.text-left
            button(type="button" onclick="$('#configChecklist,#updateChecklist').toggleClass('hidden');")  Edit
          .col-xs-6.text-right
            button(type="submit") Save
      //- configure checklist
      form#configChecklist.hidden(method="POST")
        input(type="hidden" name="action" value="config-checklist")
        table.table
          thead
            tr
              th
              for subject in checklistSubjects
                th.text-center #{subject} OK
          tbody
            tr
              th Required
              for subject in checklistSubjects
                - var item = device.checklist[subject];
                td.text-center
                  if item.required === undefined
                    input(type="checkbox" name="#{subject}" value="true" checked="checked" disabled='disabled')
                  else if item.required === true
                    input(type="checkbox" name="#{subject}" value="true" checked="checked")
                  else
                    input(type="checkbox" name="#{subject}" value="true")
        .row
          .col-xs-6.text-left
            button(type='button' onclick='window.location="/devices/#{device._id}"') Cancel
          .col-xs-6.text-right
            button(type="submit") Save
block history
  each h in device.__updates.reverse()
    +change(h, moment)
block js
  script(type='text/javascript', src='/typeahead.js/dist/typeahead.bundle.js')
  script(type='text/javascript', src='/javascripts/typeahead.js')
  script(type='text/javascript', src='/javascripts/device-action.js')
  script(type='text/javascript', src='/javascripts/template/device-details.js')
